<!DOCTYPE html> <html lang=ja > <head prefix="og: https://ogp.me/ns#"> <meta charset=utf-8  /> <meta name=viewport  content="width=device-width, initial-scale=1, maximum-scale=1" /> <meta name=robots  content=noindex  /> <meta name=author  content=heyhoe  /> <link type="text/plain" rel=author  href="https://h3y6e.com/humans.txt" /> <link rel=webmention  href="https://webmention.io/h3y6e.com/webmention" /> <link rel=pingback  href="https://webmention.io/h3y6e.com/xmlrpc" /> <link rel=me  href="https://fedibird.com/@h3y6e" /> <link rel=me  href="https://social.camph.net/@h3y6e" /> <meta name=theme-color  content="#2f2f2f" /> <link rel=stylesheet  href="/css/a5ebec.css" /> <link rel=icon  href="/assets/favicon/favicon.ico" /> <link rel=apple-touch-icon  href="/assets/favicon/apple-touch-icon.png" /> <meta property="og:site_name" content="#a5ebec" /> <meta property="og:image" content="https://res.cloudinary.com/dzugrdlkb/image/upload/c_fit,w_840,co_rgb:a5ebec,l_text:Firge35-Bold.ttf_50:Netlify%20%2B%20%20GitHub%20Actions%E3%81%A7Hugo%E8%A3%BD%E3%83%96%E3%83%AD%E3%82%B0%E3%81%AE%E4%BA%88%E7%B4%84%E6%8A%95%E7%A8%BF/fl_layer_apply,g_south_west,x_180,y_355/co_rgb:a5ebec7f,l_text:Firge35-Regular.ttf_30:2019-12-07/fl_layer_apply,g_north_west,x_180,y_565/c_fit,w_840,co_rgb:d3d5d57f,l_text:Firge35-Regular.ttf_30:%23hugo%20%23netlify%20%23githubactions%20%23ci/fl_layer_apply,g_north_west,x_180,y_605/a5ebec-ogimage-left.png" /> <meta name="twitter:card" content=summary_large_image  /> <meta name="twitter:site" content="@h3y6e" /> <meta name="twitter:creator" content="@h3y6e" /> <head prefix="og: https://ogp.me/ns#"> <title> Netlify + GitHub ActionsでHugo製ブログの予約投稿 :: #a5ebec </title> <meta name=description  content="NetlifyでホスティングしているHugo製ブログで予約投稿したいなと思ってGitHub Actions使ったらめちゃ簡単だった。" /> <meta property="og:type" content=article  /> <meta property="og:title" content="Netlify + GitHub ActionsでHugo製ブログの予約投稿 :: #a5ebec" /> <meta property="og:url" content="https://h3y6e.github.io/blog-spikey/posts/netlify-github-timed-post/index.html" /> <meta property="og:description" content="NetlifyでホスティングしているHugo製ブログで予約投稿したいなと思ってGitHub Actions使ったらめちゃ簡単だった。" /> <script src="/libs/theme/scripts/noflash.js"></script> <header> <div class=header-inner > <div class=header-logo > <a href="/"><div class=logo >#a5ebec</div></a> </div> <label for=menu-trigger  class=menu >menu</label> </div> <input type=checkbox  id=menu-trigger  /> <nav> <ul> <li><a href="https://twitter.com/h3y6e" rel=me >Twitter</a> <li><a href="https://github.com/h3y6e" rel=me >GitHub</a> <li><a href="/feed.xml">RSS</a> <li class=theme-switcher ><button id=theme-switcher >Theme</button> </ul> </nav> </header> <div class=franklin-headline > <h1 class=title >Netlify + GitHub ActionsでHugo製ブログの予約投稿</h1> <div class=date >2019-12-07</div><span class=tags ><a href="/tags/hugo">#hugo</a> <a href="/tags/netlify">#netlify</a> <a href="/tags/githubactions">#githubactions</a> <a href="/tags/ci">#ci</a> </span></div><div class=franklin-toc ><ol><li><a href="#モチベーション">モチベーション</a><li><a href="#tldr">tl;dr</a><li><a href="#netlifyのbuild_hooks">NetlifyのBuild hooks</a><li><a href="#github_actionsの_schedule">GitHub Actionsの <code>schedule</code></a><li><a href="#利点">利点</a><li><a href="#まとめ">まとめ</a></ol></div> <div class=franklin-content > <h2 id="モチベーション"><a href="#モチベーション" class=header-anchor >モチベーション</a></h2> <p>Hugoは静的サイトジェネレータであり、予約投稿というものが無い。これでは「アドベントカレンダーで0時に公開したい」などという時に困るので、どうにかして予約投稿を実現したい。</p> <h2 id=tldr ><a href="#tldr" class=header-anchor >tl;dr</a></h2> <p>Hugo製ブログをNetlifyでホスティングしている前提。 <a href="https://docs.netlify.com/configure-builds/build-hooks/#parameters">NetlifyのBuild hooks</a>と<a href="https://help.github.com/en/actions/automating-your-workflow-with-github-actions/events-that-trigger-workflows#scheduled-events-schedule">GitHub Actionsの <code>schedule</code></a>を用いる。</p> <h2 id="netlifyのbuild_hooks"><a href="#netlifyのbuild_hooks" class=header-anchor >NetlifyのBuild hooks</a></h2> <p>buildとdeployをトリガーする為のURL。 ダッシュボードの <code>Settings &gt; Build &amp; deploy &gt; Continuous Deployment &gt; Build hooks</code> にある。 Add build hookからBuild Hooks URLを作成する。nameは参照用で、Build hooksのリストとdeploy時のメッセージに表示される。 branchはmasterにする。 <img src="/img/2019-12-07/addbuildhook.png" alt="Add Build Hook" /> <img src="/img/2019-12-07/build_hooks_url.png" alt="Build Hooks URL" /> 生成されたURLを用いて、端末で以下のような <code>curl</code> コマンドを叩くと、Netlifyでbuildとdeployが実行される。</p> <pre><code class=language-shell >curl -X POST -d &#39;&#123;&#125;&#39; https://api.netlify.com/build_hooks/XXXXXXXXXXXXXXX</code></pre>
<h2 id="github_actionsの_schedule"><a href="#github_actionsの_schedule" class=header-anchor >GitHub Actionsの <code>schedule</code></a></h2>
<p>別に他のCIサービスを用いても良いのだが、自分はTravis CIしか使ったことがなかったのと、<a href="https://docs.travis-ci.com/user/cron-jobs/">Travis CIのCron Jobs</a>では <code>daily</code> が最短なので却下。 そういえばGitHub Actionsなんてものがあったなぁと思って触ってみた。</p>
<p>GitHub Actionsではリポジトリの <code>~/.github/workflows</code> 以下にYAML構文でワークフローを定義する。 ワークフローの書き方は <a href="https://help.github.com/en/actions/automating-your-workflow-with-github-actions/workflow-syntax-for-github-actions">Workflow syntax for GitHub Actions</a> を参考にされたい。</p>
<p>今回は「毎時0分にbuild &amp; deployを実行」させてみる。</p>
<pre><code class=language-yaml >name: scheduler

on:
  schedule:
    - cron: &#39;0 * * * *&#39;

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Post build hooks
      run: curl -X POST -d &#123;&#125; &#36;&#123;&#123; secrets.BUILD_HOOKS_URL &#125;&#125;</code></pre>
<p>最終行の <code>&#36;&#123;&#123; secrets.BUILD_HOOKS_URL &#125;&#125;</code> はGitHubの <code>Settings &gt; Secrets</code> に設定した変数を呼び出している。ここに先程Netlifyで生成したBuild Hooks URLを追加すればよい。 <img src="/img/2019-12-07/secrets_buildhooksurl.png" alt=Secrets  /></p>
<p>これで完成。ちょうど1時間毎に実行されていることが確認出来る。 <img src="/img/2019-12-07/scheduler_workflows.png" alt=Scheduler  /></p>
<h2 id="利点"><a href="#利点" class=header-anchor >利点</a></h2>
<h4 id="gitが汚染されない"><a href="#gitが汚染されない" class=header-anchor >gitが汚染されない</a></h4>
<p>空commitをmasterにpushすればNetlifyが自動buildしてくれるが、これだとlogが汚れるので <code>curl</code> を叩いたほうが綺麗。</p>
<h4 id="build頻度が分単位で決定出来る"><a href="#build頻度が分単位で決定出来る" class=header-anchor >build頻度が分単位で決定出来る</a></h4>
<p><code>schedule</code> を使って <a href="https://pubs.opengroup.org/onlinepubs/9699919799/utilities/crontab.html#tag_20_25_07">POSIX cron構文</a> で記述出来る。</p>
<h4 id="ほぼ無料"><a href="#ほぼ無料" class=header-anchor >（ほぼ）無料</a></h4>
<p>Publicリポジトリなら無料、Privateでもこの程度の使用なら無料。（Freeで2,000分/月）</p>
<h4 id="簡単"><a href="#簡単" class=header-anchor >簡単</a></h4>
<p>学習コスト低い。</p>
<h2 id="まとめ"><a href="#まとめ" class=header-anchor >まとめ</a></h2>
<p>意外と簡単にできた。これ書いてるのがアドベントカレンダー前日。上手くいくと良いな〜。</p>
<footer class=page-foot >
  
  <p>
    Comment on <a href="https://twitter.com/intent/tweet?text=Reading%20%40h3y6e%27s%20https%3A%2F%2Fh3y6e.github.io%2Fblog-spikey%2Fposts%2Fnetlify-github-timed-post%2Findex.html">Twitter</a> /
    <a href="https://elk.zone/intent/post?text=Reading%20%40h3y6e%40social.camph.net%27s%20https%3A%2F%2Fh3y6e.github.io%2Fblog-spikey%2Fposts%2Fnetlify-github-timed-post%2Findex.html">Mastodon</a>
  </p>
  <p>
    <a href="https://github.com/h3y6e/blog-spikey/blob/master/posts/netlify-github-timed-post.md">
      
      &#xE0A0; Edit this page on GitHub
    </a>
  </p>
  
  <div class=copyright >
    <span>
      &copy; 2019-2025 <a href="https://h3y6e.com">heyhoe</a>
    </span>
    <span>::Powered py <a href="https://franklinjl.org/">Franklin.jl</a></span>
  </div>
</footer>
</div><script src="/libs/theme/scripts/switcher.js"></script>

 <script src="/libs/highlight/highlight.min.js"></script>
<script src="/libs/highlight/ln.min.js"></script>
<script>
  hljs.initHighlightingOnLoad();
  hljs.initLineNumbersOnLoad({ singleLine: true });
  hljs.configure({ tabReplace: "    " });
</script>