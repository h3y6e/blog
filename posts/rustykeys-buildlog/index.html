<!DOCTYPE html> <html lang=ja > <head prefix="og: https://ogp.me/ns#"> <meta charset=utf-8  /> <meta name=viewport  content="width=device-width,initial-scale=1,maximum-scale=1" /> <meta name=author  content=heyhoe  /> <meta name=theme-color  content="#2f2f2f" /> <link rel=stylesheet  href="/css/a5ebec.css" /> <link rel=icon  href="/assets/favicon/favicon.ico" /> <link rel=apple-touch-icon  href="/assets/favicon/apple-touch-icon.png" /> <meta property="og:site_name" content="#a5ebec" /> <meta property="og:image" content="https://blog.h3y6e.com/img/2022-05-02/rustykeys.jpg" /> <meta name="twitter:card" content=summary_large_image  /> <meta name="twitter:site" content="@h3y6e" /> <meta name="twitter:creator" content="@h3y6e" /> <head prefix="og: https://ogp.me/ns#"> <title> RustyKeys ビルドログ :: #a5ebec </title> <meta name=description  content="RustyKeysのビルドログです。" /> <meta property="og:type" content=article  /> <meta property="og:title" content="RustyKeys ビルドログ :: #a5ebec" /> <meta property="og:url" content="https://blog.h3y6e.com/posts/rustykeys-buildlog/index.html" /> <meta property="og:description" content="RustyKeysのビルドログです。" /> <script src="/libs/scripts/noflash.js"></script> <header> <div class=header-inner > <div class=header-logo > <a href="/"><div class=logo >#a5ebec</div></a> </div> <label for=menu-trigger  class=menu >menu</label> </div> <input type=checkbox  id=menu-trigger  /> <nav> <ul> <li><a href="/">Posts</a> <li><a href="/tags">Tags</a> <li><a href="/about">About</a> <li><a href="/feed.xml">RSS</a> <li class=theme-switcher ><button id=theme-switcher >Theme</button> </ul> </nav> </header> <div class=franklin-headline > <h1 class=title >RustyKeys ビルドログ</h1> <div class=date >2022-05-02</div><span class=tags ><a href="/tags/keyboard">#keyboard</a> <a href="/tags/buildlog">#buildlog</a> </span></div><div class=franklin-toc ><ol><li><a href="#はじめに">はじめに</a><li><a href="#rustykeysの特徴">RustyKeysの特徴</a><li><a href="#ビルドガイド">ビルドガイド</a><li><a href="#内容物の確認">内容物の確認</a><li><a href="#自分で用意するもの">自分で用意するもの</a><li><a href="#工具">工具</a><ol><li><a href="#camphor-_make">CAMPHOR- Make</a></ol><li><a href="#本体の組み立て">本体の組み立て</a><ol><li><a href="#ダイオードのはんだ付け">ダイオードのはんだ付け</a><li><a href="#キースイッチのルブ">キースイッチのルブ</a><li><a href="#ソケットのはんだ付け">ソケットのはんだ付け</a><li><a href="#l字ピンヘッダのはんだ付け">L字ピンヘッダのはんだ付け</a><li><a href="#raspberry_pi_picoのはんだ付け">Raspberry Pi Picoのはんだ付け</a><li><a href="#ゴム足の取り付け">ゴム足の取り付け</a><li><a href="#キースイッチキーキャップの取り付け">キースイッチ、キーキャップの取り付け</a></ol><li><a href="#デバッグアダプタの組み立て">デバッグアダプタの組み立て</a><ol><li><a href="#ピンヘッダのはんだ付け">ピンヘッダのはんだ付け</a></ol><li><a href="#ファームウェアの書き込み">ファームウェアの書き込み</a><ol><li><a href="#必要なツールのインストール">必要なツールのインストール</a><li><a href="#デバッグアダプタのファームウェア">デバッグアダプタのファームウェア</a><li><a href="#本体のファームウェア">本体のファームウェア</a></ol></ol></div> <div class=franklin-content > <script async src="https://platform.twitter.com/widgets.js" charset=utf-8 ></script> <h2 id="はじめに"><a href="#はじめに" class=header-anchor >はじめに</a></h2> <p>本稿は<a href="https://twitter.com/KOBA789">KOBA789</a>さんが設計された<a href="https://koba789.booth.pm/items/3787019">RustyKeys</a>のビルドログです。参考までに活用していただければ幸いです。</p> <p>また、RustyKeysのコミュニティがGitHub Discussionsで作られていますので、このキットについての質問や依頼はこちらにコメントを残すと幸せになれると思います。</p> <div class=embed > <a href="https://github.com/KOBA789/rusty-keys/discussions" target=_blank ></a> <img src="https://opengraph.githubassets.com/72eac1a6b6014e82e0fe28fd89f54f1fd9a1afc745b1ca5fa4aa3c54e5189cb5/KOBA789/rusty-keys" alt="rusty-keys のファームウェアのサンプルコードと基板の設計データ. Contribute to KOBA789/rusty-keys development by creating an account on GitHub." decoding=async  loading=lazy > <div class=embed-content > <b>Discussions · KOBA789</b> <p>rusty-keys のファームウェアのサンプルコードと基板の設計データ. Contribute to KOBA789/rusty-keys development by creating an account on GitHub.</p> <div class=domain >github.com</div> </div> </div> <hr /> <p><a href="https://youtu.be/7Rn1n0EEcfo">KOBA789さんのYouTube Live</a>を観て面白そうなキットだなぁと思い、ゴールデンウィークのお供にと購入しました。 販売開始前から全裸待機していたら無事に買えました。1分で売り切れたようです。やば。</p> <blockquote class=twitter-tweet  data-theme=dark  data-dnt=true  align=center ><p lang=ja  dir=ltr >買えました。良かった / 「RustyKeys (初回版（再販予定なし）)」を Bracket Works で購入しました！ <a href="https://t.co/sJ5Cxk5byM">https://t.co/sJ5Cxk5byM</a> <a href="https://twitter.com/hashtag/booth_pm?src=hash&amp;ref_src=twsrc%5Etfw">#booth_pm</a></p>&mdash; へいほぅ (@h3y6e) <a href="https://twitter.com/h3y6e/status/1518534492902035456?ref_src=twsrc%5Etfw">April 25, 2022</a></blockquote> <h2 id="rustykeysの特徴"><a href="#rustykeysの特徴" class=header-anchor >RustyKeysの特徴</a></h2> <div class=embed > <a href="https://shop.yushakobo.jp/products/4256" target=_blank ></a> <img src="https://cdn.shopify.com/s/files/1/0532/0880/9633/products/ad96f9e0ee8b7a69fb5e813fa641850e.jpg?v=1651140420" alt="RustyKeys は、組込み Rust 入門に最適な1台を目指して開発された自作キーボードのキットです。" decoding=async  loading=lazy > <div class=embed-content > <b>【委託】RustyKeys</b> <p>RustyKeys は、組込み Rust 入門に最適な1台を目指して開発された自作キーボードのキットです。</p> <div class=domain >shop.yushakobo.jp</div> </div> </div> <p>最大の特徴は、<a href="https://rusty-keys.koba789.com">ビルドガイド</a>が組込みRustをサポートしており、既存のファームウェアには対応していない、という所でしょう。</p> <p>勿論6キーのマクロパッドとしても利用可能ですが、組み立て・プログラミング自体を楽しむことを目的として開発されている為、組み込みRust入門・はんだ付け入門・キーボード自作入門に最適なキットとなっています。</p> <h2 id="ビルドガイド"><a href="#ビルドガイド" class=header-anchor >ビルドガイド</a></h2> <p>ビルドガイドは <a href="https://rusty-keys.koba789.com">rusty-keys.koba789.com</a> です。 <strong>作業の前に、必ず一読するようにしましょう。</strong></p> <h2 id="内容物の確認"><a href="#内容物の確認" class=header-anchor >内容物の確認</a></h2> <p>内容物は以下のようになっています。</p> <p><img src="/img/2022-05-02/kit.jpg" alt="キット" /></p> <ul> <li><p>基板: 1枚</p> <li><p>Raspberry Pi Pico: 2個</p> <ul> <li><p>2つのRaspberry Pi Picoのうち1つはキーボード用、もう1つはデバッグアダプタ用です。</p> </ul> <li><p>1N4148（ダイオード）: 6個</p> <li><p>L字ピンヘッダ（3P）: 1個</p> <li><p>ジャンパ線（ソケット-ソケット3P）: 1本</p> <li><p>ピンヘッダ（40P）: 1個</p> <li><p>ゴム足: 4個</p> </ul> <h2 id="自分で用意するもの"><a href="#自分で用意するもの" class=header-anchor >自分で用意するもの</a></h2> <ul> <li><p>Cherry MX互換キースイッチ: 6個</p> </ul> <p>今回は<a href="https://shop.yushakobo.jp/products/kailh-box-silent-switch">Kailh BOX Silent Pink</a>を用いました。 また、キースイッチをはんだ付け無しで取り外し（ソケット化）出来るようにする<a href="https://shop.yushakobo.jp/products/a0500mm?variant&#61;37665260634273">Mill-Max Socket</a>が余っていたのでこれを使いました。</p> <p><img src="/img/2022-05-02/keyswitches.jpg" alt="キースイッチ" /></p> <ul> <li><p>キーキャップ: 6個</p> </ul> <p>キーキャップには<a href="https://talpkeyboard.net/items/5ecdd2fdcee9ea12129dbe11">TEX ADA -Film Never Dies-</a>を使いました。フィルムカメラがモチーフのノベルティキーキャップセットです。プロファイルはADAという、DSAよりも更に窪んだ形状をしており、打鍵音は低めで小さいように感じます。</p> <p><img src="/img/2022-05-02/keycaps.jpg" alt="キーキャップ" /></p> <ul> <li><p>USB micro-Bケーブル: 2本</p> </ul> <p>片方がmicro-Bプラグであれば何でも良いです。<br/> Macで開発するのでもう片方がUSB Type-Cプラグのものを使っています。 2本用意します。</p> <p><img src="/img/2022-05-02/cable.jpg" alt="USB micro-Bケーブル" /></p> <h2 id="工具"><a href="#工具" class=header-anchor >工具</a></h2> <p>RustyKeysを始め、自作キーボードキットの組み立てにははんだ付けが必要です。</p> <p>必要な工具を1つずつ購入するのが面倒な方は、遊舎工房さんで購入可能な工具セット（全部入りセット）を買うのが良いでしょう。</p> <div class=embed > <a href="https://shop.yushakobo.jp/products/a9900to" target=_blank ></a> <img src="https://cdn.shopify.com/s/files/1/0532/0880/9633/products/P2083794.jpg?v=1612414515" alt="遊舎工房の工作室で使われている工具セットです。 基本セット（はんだ付けセット） ・HAKKO FX600 http://www.hakko.com/japan/products/hakko_fx600.html 温度調整機能を搭載したスティック型のはんだごてです。 ・T18-D16 先がフラットになっているFX600用のコテ先です。 ・HAKKO 633-01 https://www.hakko.com/japan/products/hakko_kote_board.html FX600用のコテ台とコテ先クリーナーです。クリーナーは加水不要のワイヤータイプ（HAKKO 599B :https://www.hakko.com/japa" decoding=async  loading=lazy > <div class=embed-content > <b>工具セット</b> <p>遊舎工房の工作室で使われている工具セットです。 基本セット（はんだ付けセット） ・HAKKO FX600 http://www.hakko.com/japan/products/hakko_fx600.html 温度調整機能を搭載したスティック型のはんだごてです。 ・T18-D16 先がフラットになっているFX600用のコテ先です。 ・HAKKO 633-01 https://www.hakko.com/japan/products/hakko_kote_board.html FX600用のコテ台とコテ先クリーナーです。クリーナーは加水不要のワイヤータイプ（HAKKO 599B :https://www.hakko.com/japa</p> <div class=domain >shop.yushakobo.jp</div> </div> </div> <p>この他には<a href="https://amzn.to/3ydNMeK">作業マット</a>、<a href="https://amzn.to/3vUUFPp">マルチテスター</a>もあると良いです。</p> <h3 id=camphor-_make ><a href="#camphor-_make" class=header-anchor >CAMPHOR- Make</a></h3> <p>2万円弱もかけて工具を一式揃えるのはちょっと...という学生に朗報です。<br/> 僕の所属している京都の学生ITコミュニティ<a href="https://camph.net">CAMPHOR-</a>では、CAMPHOR- Makeというちょっとしたメイカースペースがあります。</p> <p>上で紹介した工具は勿論、</p> <ul> <li><p>温調ステーション型はんだごて</p> <li><p>はんだ吸煙器</p> <li><p>絶縁断熱マット</p> <li><p>マルチテスター</p> </ul> <p>など、自作キーボードに便利な工具が揃っています。</p> <p>お近くにお住まいの方は是非お越しください。開館スケジュールは<a href="https://camph.net/schedule">こちら</a>になります。<br/> お待ちしております！</p> <div class=embed > <a href="https://blog.camph.net/news/open-camphor-make/" target=_blank ></a> <img src="https://blog.camph.net/wp-content/uploads/2021/05/IMG_1255-1024x768.png" alt="こんにちは、 CAMPHOR- 運営メンバーの れおまる です。 3/27 に開催した CAMPHOR- DAY 2021 にてCAMPHOR- Makeのスタートを告知しました！ Makeに関するLTのアーカイブは ここ から見ることができますのでぜひご覧ください！ CAMPHOR- Makeとは？ CAMPHOR-" decoding=async  loading=lazy > <div class=embed-content > <b>Makeをオープンします！</b> <p>こんにちは、 CAMPHOR- 運営メンバーの れおまる です。 3/27 に開催した CAMPHOR- DAY 2021 にてCAMPHOR- Makeのスタートを告知しました！ Makeに関するLTのアーカイブは ここ から見ることができますのでぜひご覧ください！ CAMPHOR- Makeとは？ CAMPHOR-</p> <div class=domain >blog.camph.net</div> </div> </div> <h2 id="本体の組み立て"><a href="#本体の組み立て" class=header-anchor >本体の組み立て</a></h2> <p>RustyKeys本体の組み立てを行います。</p> <h3 id="ダイオードのはんだ付け"><a href="#ダイオードのはんだ付け" class=header-anchor >ダイオードのはんだ付け</a></h3> <p>ダイオードのリード線を曲げます。 今回は6個なので1つずつ曲げてもそれほど時間はかかりません。</p> <p>大量のダイオードを曲げることがあるなら、Thingiverse等で<a href="https://www.thingiverse.com/search?q&#61;Diode&#43;bender">Diode bender</a>と検索してダイオードをいい感じに曲げてくれる君の3Dモデルを手に入れ、3Dプリンタ<sup id="fnref:make"><a href="#fndef:make" class=fnref >[1]</a></sup> で印刷すると良いでしょう。</p> <p><img src="/img/2022-05-02/bended_diode.jpg" alt="曲げダイオード" /></p> <p>基板に印刷された白い帯とダイオードに印刷された黒い帯が合うように、向きを確認して差し込みます。</p> <p><img src="/img/2022-05-02/diodes.jpg" alt="ダイオード" /></p> <p>マスキングテープ等で固定することで、はんだ付けがやり易くなります。</p> <p><img src="/img/2022-05-02/maskingtape.jpg" alt="マスキングテープ" /></p> <p>ダイオードのはんだ付けを行います。</p> <p><img src="/img/2022-05-02/soldered_diodes.jpg" alt="ダイオードのはんだ付け" /></p> <p>リード線の余った部分をペンチで切り落とします。切った際にどこかに飛んでいかないように、テープで繋げておくと良いです。</p> <p><img src="/img/2022-05-02/remove_lead_wires.jpg" alt="リード線の除去" /></p> <table class=fndef  id="fndef:make"> <tr> <td class=fndef-backref ><a href="#fnref:make">[1]</a> <td class=fndef-content >先程紹介した<a href="https://blog.camph.net/news/open-camphor-make/">CAMPHOR- Make</a>には積層方式と光造形方式の3Dプリンタがあるので、是非ここで印刷してみては如何でしょうか。 </table> <h3 id="キースイッチのルブ"><a href="#キースイッチのルブ" class=header-anchor >キースイッチのルブ</a></h3> <p>今回用いる<a href="https://shop.yushakobo.jp/products/kailh-box-silent-switch">Kailh BOX Silent Pink</a>は押下圧が軽めで軸のぐらつきが少ない静音リニア軸です。 値段もそこまで高く無いので、安定して静音なキースイッチを求めている方にはお勧めです。</p> <p>そのままでも静かなのですが、ルブることで更にノイズを軽減することが出来るので、やっておきます。 使用する潤滑剤は、リニアMXスイッチ用である<a href="https://shop.yushakobo.jp/products/lubricants?_pos&#61;1&amp;_sid&#61;b3d9bc2ba&amp;_ss&#61;r&amp;variant&#61;37665260994721">Krytox GPL 205 G0</a>です。</p> <p><img src="/img/2022-05-02/lube.jpg" alt="ルブ" /></p> <p>以下の3つを買っておけばとりあえずルブは出来ます。使用するキースイッチがリニア軸でない場合は<a href="https://shop.yushakobo.jp/products/lubricants?_pos&#61;1&amp;_sid&#61;b3d9bc2ba&amp;_ss&#61;r&amp;variant&#61;37665260961953">Tribosys 3204</a>が汎用的でお勧めです。</p> <p><div class=embed > <a href="https://shop.yushakobo.jp/products/kbdfans-lube-tools-collection" target=_blank ></a> <img src="https://cdn.shopify.com/s/files/1/0532/0880/9633/products/s-1_8e3848e1-642a-4605-a507-bf3bbe7c0c50.jpg?v=1612412709" alt="ルブ作業に使用する道具のセットです 内容物 ・ステムホルダー x 1 ・ピンセットx 1 ・筆 x 2" decoding=async  loading=lazy > <div class=embed-content > <b>KBDfans Lube Tools Collection</b> <p>ルブ作業に使用する道具のセットです 内容物 ・ステムホルダー x 1 ・ピンセットx 1 ・筆 x 2</p> <div class=domain >shop.yushakobo.jp</div> </div> </div> <div class=embed > <a href="https://shop.yushakobo.jp/products/kbdfans-x-ai03-2-in-1-アルミニウムスイッチオープナー" target=_blank ></a> <img src="https://cdn.shopify.com/s/files/1/0532/0880/9633/products/sw-189-1.jpg?v=1612414012" alt="ai03氏デザインのアルミ切削スイッチオープナーです Cherry MX と Kailh (CPG1511)ハウジングに対応しています" decoding=async  loading=lazy > <div class=embed-content > <b>KBDfans x ai03 2 in 1 アルミニウムスイッチオープナー</b> <p>ai03氏デザインのアルミ切削スイッチオープナーです Cherry MX と Kailh (CPG1511)ハウジングに対応しています</p> <div class=domain >shop.yushakobo.jp</div> </div> </div> <div class=embed > <a href="https://shop.yushakobo.jp/products/lubricants" target=_blank ></a> <img src="https://cdn.shopify.com/s/files/1/0532/0880/9633/products/Lub0829-480-2.jpg?v=1661763919" alt="スイッチの感触をスムーズにするための潤滑剤です。 ※輸送中に潤滑剤によって容器のフタが緩み、チャック袋内で漏れることがあります。 この理由による交換には応じかねますのでご了承ください。 参考URL https://scrapbox.io/self-made-kbds-ja/Krytox_GPL https://scrapbox.io/self-made-kbds-ja/Tribosys" decoding=async  loading=lazy > <div class=embed-content > <b>潤滑剤</b> <p>スイッチの感触をスムーズにするための潤滑剤です。 ※輸送中に潤滑剤によって容器のフタが緩み、チャック袋内で漏れることがあります。 この理由による交換には応じかねますのでご了承ください。 参考URL https://scrapbox.io/self-made-kbds-ja/Krytox_GPL https://scrapbox.io/self-made-kbds-ja/Tribosys</p> <div class=domain >shop.yushakobo.jp</div> </div> </div> </p> <p>スイッチオープナーを用いてキースイッチを分解し、それぞれの部品で他の部品と擦れる場所にルブをしていきます。 今回は6つしかキーが無いので楽ですね。</p> <p><img src="/img/2022-05-02/lubing.jpg" alt="ルビング" /></p> <h3 id="ソケットのはんだ付け"><a href="#ソケットのはんだ付け" class=header-anchor >ソケットのはんだ付け</a></h3> <p><a href="https://shop.yushakobo.jp/products/a0500mm?variant&#61;37665260634273">Mill-Max Socket</a>をはんだ付けします。まずは全てのキースイッチにソケットを以下のように嵌めます。</p> <p><img src="/img/2022-05-02/sockets.jpg" alt="ソケット" /></p> <p>キースイッチを基板に差し込み、裏返してはんだ付けします。</p> <p><img src="/img/2022-05-02/soldering_sockets.jpg" alt="ソケットのはんだ付け" /></p> <p>キースイッチを外すとこんな感じになります。</p> <p><img src="/img/2022-05-02/soldered_sockets.jpg" alt="はんだ付けされたソケット" /></p> <h3 id="l字ピンヘッダのはんだ付け"><a href="#l字ピンヘッダのはんだ付け" class=header-anchor >L字ピンヘッダのはんだ付け</a></h3> <p>L字ピンヘッダ（3ピン）をはんだ付けします。<br/> 固定せずにはんだ付けした為、ちょっと曲がってしまいました。ここもダイオードと同様にマスキングテープで固定しておくのが良さそうです。</p> <p><img src="/img/2022-05-02/l_pin_header.jpg" alt="L字ピンヘッダ" /></p> <h3 id="raspberry_pi_picoのはんだ付け"><a href="#raspberry_pi_picoのはんだ付け" class=header-anchor >Raspberry Pi Picoのはんだ付け</a></h3> <p>Raspberry Pi Picoのはんだ付けを行います。本キットでは端面スルーホールではんだ付けを行うのですが、付属のピンヘッダを半分に切って差し込み、位置合わせを行います。</p> <p>以下の図ように、手前は下から差し込み、奥は上から差し込むと、Raspberry Pi Picoがしっかりと固定されてはんだ付けしやすかったです。</p> <p><img src="/img/2022-05-02/soldering_pico.jpg" alt="Raspberry Pi Picoのはんだ付け" /></p> <p>片側がはんだ付け出来たら、ピンヘッダを外してもう一方とデバッグ用ピンのはんだ付けを行います。</p> <p><img src="/img/2022-05-02/soldered_pico.jpg" alt="はんだ付けされたRaspberry Pi Pico" /></p> <h3 id="ゴム足の取り付け"><a href="#ゴム足の取り付け" class=header-anchor >ゴム足の取り付け</a></h3> <p>裏面にゴム足を取り付けます。四隅に白円が印刷されているので、それに合わせて貼り付けます。</p> <p><img src="/img/2022-05-02/rubber_foot.jpg" alt="ゴム足" /></p> <h3 id="キースイッチキーキャップの取り付け"><a href="#キースイッチキーキャップの取り付け" class=header-anchor >キースイッチ、キーキャップの取り付け</a></h3> <p>キースイッチとキーキャップを取り付け、本体の組み立ては完了です。</p> <p><img src="/img/2022-05-02/set_keys.jpg" alt="キースイッチとキーキャップの取り付け" /></p> <h2 id="デバッグアダプタの組み立て"><a href="#デバッグアダプタの組み立て" class=header-anchor >デバッグアダプタの組み立て</a></h2> <p>本体が組み立てられたので、次はデバッグアダプタを組み立てます。組み立てと言ってもピンヘッダをはんだ付けするだけです。</p> <h3 id="ピンヘッダのはんだ付け"><a href="#ピンヘッダのはんだ付け" class=header-anchor >ピンヘッダのはんだ付け</a></h3> <p><img src="/img/2022-05-02/debug_adapter.jpg" alt="デバッグアダプタ" /></p> <p>デバッグに用いるピンは <code>GND</code>, <code>GP2</code>, <code>GP4</code> の3ピンのみなので、その部分（と固定のための <code>GP0</code>,<code>GP15</code>）をはんだ付けしておきました。</p> <p>これでデバッグアダプタの組み立ては完了です。はんだ付けのフェーズは以上になります。</p> <h2 id="ファームウェアの書き込み"><a href="#ファームウェアの書き込み" class=header-anchor >ファームウェアの書き込み</a></h2> <p>現在、多くの自作キーボードキットは<a href="https://github.com/qmk/qmk_firmware">QMK Firmware</a>というファームウェアに対応しています。 他に有名な設定ツールとして、QMK Firmware派生の<a href="https://www.caniusevia.com">VIA</a>, <a href="https://remap-keys.app">Remap</a>, <a href="https://get.vial.today">Vial</a>などがあります。 Raspberry Pi PicoのようなRP2040チップであれば、CircuitPythonで記述出来る<a href="https://github.com/KMKfw/kmk_firmware">kmk_firmware</a>やPicoRubyで記述出来る<a href="https://github.com/picoruby/prk_firmware">prk_firmware</a>などを使えばキーボードとして動作します。</p> <p>RustyKeysキットではこれらの既存のファームウェアを用いることなく、組み込みRustで開発します！<br/> 2022/5/2現在、<a href="https://rusty-keys.koba789.com/firmware/first_keyboard"><strong>作者様の名前が入力可能な最高のキーボード</strong></a>まではビルドガイドに含まれていますのでそこまでやってみましょう。</p> <p>自分の開発環境は以下の通りです。</p> <pre><code class=language-sh >❯ uname -a
Darwin mbp2019.local 21.4.0 Darwin Kernel Version 21.4.0: Fri Mar 18 00:45:05 PDT 2022; root:xnu-8020.101.4~15/RELEASE_X86_64 x86_64</code></pre> <h3 id="必要なツールのインストール"><a href="#必要なツールのインストール" class=header-anchor >必要なツールのインストール</a></h3> <p>ビルドガイド通りに作業していればもう済んでいることかと思いますが、必要な環境及びツールは<a href="https://rusty-keys.koba789.com/devenv">ビルドガイド</a>を参考にインストールしておきましょう。</p> <pre><code class=language-sh ># Install Rust
❯ curl --proto &#39;&#61;https&#39; --tlsv1.2 -sSf https://sh.rustup.rs | sh
# ...or Update Rust
❯ rustup update

# Add thumbv6m-none-eabi target
❯ rustup target add thumbv6m-none-eabi

# Install probe-run
❯ cargo install probe-run
# Install flip-link
❯ cargo install flip-link
# Install elf2uf2-rs
❯ cargo install elf2uf2-rs</code></pre> <h3 id="デバッグアダプタのファームウェア"><a href="#デバッグアダプタのファームウェア" class=header-anchor >デバッグアダプタのファームウェア</a></h3> <p><a href="https://github.com/ciniml/rust-dap">rust-dap</a>をデバッグアダプタに書き込みます。 デバッグアダプタ用のRaspberry Pi Picoと開発用PCをUSBケーブルで接続し、以下を実行します。</p> <pre><code class=language-sh >❯ git clone https://github.com/ciniml/rust-dap.git
❯ cd boards/xiao_rp2040
❯ cargo run --release</code></pre> <h3 id="本体のファームウェア"><a href="#本体のファームウェア" class=header-anchor >本体のファームウェア</a></h3> <p>ジャンパ線で本体とデバッグアダプタを接続します。対応は以下です。</p> <table><tr><th align=left >本体側ピン<th align=left >デバッグアダプタ側ピン<tr><td align=left >SWDIO<td align=left >GP4（GPIO4）<tr><td align=left >GND<td align=left >GND<tr><td align=left >SWCLK<td align=left >GP2（GPIO2）</table> <p>デバッグアダプタ -&gt; 本体の順に、2本のUSBケーブルで開発用PCに接続します。</p> <p>ファームウェアのサンプルコードは<a href="https://github.com/KOBA789/rusty-keys">rusty-keys</a>の <code>firmware</code> 下に用意されているので、cloneします。</p> <div class=embed > <a href="https://github.com/KOBA789/rusty-keys" target=_blank ></a> <img src="https://opengraph.githubassets.com/72eac1a6b6014e82e0fe28fd89f54f1fd9a1afc745b1ca5fa4aa3c54e5189cb5/KOBA789/rusty-keys" alt="rusty-keys のファームウェアのサンプルコードと基板の設計データ. Contribute to KOBA789/rusty-keys development by creating an account on GitHub." decoding=async  loading=lazy > <div class=embed-content > <b>KOBA789/rusty-keys</b> <p>rusty-keys のファームウェアのサンプルコードと基板の設計データ. Contribute to KOBA789/rusty-keys development by creating an account on GitHub.</p> <div class=domain >github.com</div> </div> </div> <pre><code class=language-sh >❯ git clone https://github.com/KOBA789/rusty-keys.git
❯ cd rusty-keys</code></pre> <h4 id=firmwarehello ><a href="#firmwarehello" class=header-anchor >firmware/hello</a></h4> <p>デバッグ出力に <code>Hello, world&#33;</code> を出力するサンプルコードです。</p> <pre><code class=language-sh >❯ cd firmware/hello/
❯ cargo run</code></pre> <pre><code class=language-sh >Finished dev &#91;unoptimized &#43; debuginfo&#93; target&#40;s&#41; in 35.00s
     Running &#96;probe-run --chip RP2040 target/thumbv6m-none-eabi/debug/rusty-keys-hello&#96;
&#40;HOST&#41; INFO  flashing program &#40;6 pages / 24.00 KiB&#41;
&#40;HOST&#41; INFO  success&#33;
────────────────────────────────────────────────────────────────────────────────
Hello, world&#33;
└─ rusty_keys_hello::__cortex_m_rt_main @ src/main.rs:21
────────────────────────────────────────────────────────────────────────────────
&#40;HOST&#41; INFO  device halted without error</code></pre> <p>表示されたことが確認出来ました。<a href="https://github.com/knurling-rs/probe-run"><code>probe-run</code></a> 凄い...。 動作を見ると分かりますが、書き込みはprobe（デバッグアダプタ）を通して行われているようですね。</p> <h4 id=firmwarekeyboard ><a href="#firmwarekeyboard" class=header-anchor >firmware/keyboard</a></h4> <p>USBキーボードのサンプルコードです。</p> <p><a href="https://github.com/KOBA789/rusty-keys/blob/main/firmware/keyboard/src/bin/simple.rs"><code>src/bin/sample.rs</code></a>に <code>k</code> <code>o</code> <code>b</code> <code>a</code> <code>7</code> <code>8</code> <code>9</code> や修飾キーなどが入力出来るようになるサンプルコードがあります。</p> <pre><code class=language-sh >❯ cd ..
❯ cd keyboard/
❯ cargo run --release --bin simple</code></pre> <pre><code class=language-sh >Finished release &#91;optimized &#43; debuginfo&#93; target&#40;s&#41; in 33.94s
     Running &#96;probe-run --chip RP2040 target/thumbv6m-none-eabi/release/simple&#96;
&#40;HOST&#41; INFO  flashing program &#40;8 pages / 32.00 KiB&#41;
&#40;HOST&#41; INFO  success&#33;
────────────────────────────────────────────────────────────────────────────────</code></pre> <p>作者様の名前が入力可能な最高のキーボードが完成しました🎉</p> <p><img src="/img/2022-05-02/out.gif" alt="作者様の名前が入力可能な最高のキーボード" /></p> <blockquote class=twitter-tweet  data-theme=dark  data-dnt=true  align=center ><p lang=ja  dir=ltr >RustyKeysできた。Mil-Max Socketが余っていたのでホットスワップ化した <a href="https://t.co/TLHjC9G9Fi">pic.twitter.com/TLHjC9G9Fi</a></p>&mdash; へいほぅ (@h3y6e) <a href="https://twitter.com/h3y6e/status/1520812444519911425?ref_src=twsrc%5Etfw">May 1, 2022</a></blockquote> <footer class=page-foot > <p> <a href="https://github.com/h3y6e/blog/blob/master/posts/rustykeys-buildlog.md"> &#xE0A0; Edit this page on GitHub </a> </p> <div class=copyright > <span> &copy; 2019-2023 <a href="https://h3y6e.com">heyhoe</a> </span> <span>::Powered py <a href="https://franklinjl.org/">Franklin.jl</a></span> </div> </footer> </div><script src="/libs/scripts/switcher.js"></script> <script src="/libs/highlight/highlight.min.js"></script> <script src="/libs/highlight/ln.min.js"></script> <script> hljs.initHighlightingOnLoad(); hljs.initLineNumbersOnLoad({ singleLine: true }); hljs.configure({ tabReplace: " " }); </script>