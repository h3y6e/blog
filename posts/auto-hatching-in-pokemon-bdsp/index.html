<!DOCTYPE html> <html lang=ja > <head prefix="og: https://ogp.me/ns#"> <meta charset=utf-8  /> <meta name=viewport  content="width=device-width,initial-scale=1,maximum-scale=1" /> <meta name=author  content=heyhoe  /> <meta name=theme-color  content="#2f2f2f" /> <link rel=stylesheet  href="/libs/katex/katex.min.css" /> <link rel=stylesheet  href="/css/a5ebec.css" /> <link rel=icon  href="/assets/favicon/favicon.ico" /> <link rel=apple-touch-icon  href="/assets/favicon/apple-touch-icon.png" /> <meta property="og:site_name" content="#a5ebec" /> <meta property="og:image" content="https://blog.h3y6e.com/img/2021-12-01/6v.jpg" /> <meta name="twitter:card" content=summary_large_image  /> <meta name="twitter:site" content="@h3y6e" /> <meta name="twitter:creator" content="@h3y6e" /> <title> 【ポケモンBDSP】自動孵化装置を作って高個体値色違いイーブイを手に入れる(夢を見た) :: #a5ebec </title> <meta name=description  content="Pro Micro(Arduino Leonardo互換機)でポケモンBDSP版自動孵化装置を作成する。" /> <meta property="og:type" content=article  /> <meta property="og:title" content="【ポケモンBDSP】自動孵化装置を作って高個体値色違いイーブイを手に入れる(夢を見た) :: #a5ebec" /> <meta property="og:url" content="https://blog.h3y6e.com/posts/auto-hatching-in-pokemon-bdsp/index.html" /> <meta property="og:description" content="Pro Micro(Arduino Leonardo互換機)でポケモンBDSP版自動孵化装置を作成する。" /> <header> <div class=header-inner > <div class=header-logo > <a href="/"><div class=logo >#a5ebec</div></a> </div> <label for=trigger  class=menu >menu</label> </div> <input type=checkbox  id=trigger  /> <nav> <ul> <li><a href="/">Posts</a> <li><a href="/tags">Tags</a> <li><a href="/about">About</a> </ul> </nav> </header> <div class=franklin-headline > <h1 class=title >【ポケモンBDSP】自動孵化装置を作って高個体値色違いイーブイを手に入れる(夢を見た)</h1> <div class=date >2021-12-01</div><span class=tags ><a href="/tags/camphor">#camphor</a> <a href="/tags/adventcalendar">#adventcalendar</a> <a href="/tags/automation">#automation</a> <a href="/tags/pokemon">#pokemon</a> </span></div><div class=franklin-toc ><ol><li><a href="#tldr">tl;dr</a><li><a href="#はじめに">はじめに</a><li><a href="#ドメイン知識_タマゴ">ドメイン知識: タマゴ</a><ol><li><a href="#タマゴが見つかる条件">タマゴが見つかる条件</a><li><a href="#タマゴのサイクル数">タマゴのサイクル数</a><li><a href="#廃人ロード">廃人ロード</a><li><a href="#参考_ダイヤモンドダスト">参考: ダイヤモンドダスト</a></ol><li><a href="#nintendo_switchコントローラ">Nintendo Switchコントローラ</a><ol><li><a href="#usb_hid">USB HID</a><li><a href="#atmega32u4">ATmega32U4</a></ol><li><a href="#実装">実装</a><ol><li><a href="#方針">方針</a><li><a href="#初期位置に移動する">初期位置に移動する</a><li><a href="#タマゴを受け取る">タマゴを受け取る</a><li><a href="#廃人ロードを往復する">廃人ロードを往復する</a><li><a href="#ボックスを操作する">ボックスを操作する</a></ol><li><a href="#結果">結果</a><li><a href="#おわりに">おわりに</a></ol></div> <div class=franklin-content > <p>この記事は、<a href="https://advent.camph.net/">CAMPHOR- Advent Calendar 2021</a>の2日目の記事です。</p> <h2 id=tldr ><a href="#tldr" class=header-anchor >tl;dr</a></h2> <blockquote class=twitter-tweet  data-theme=dark ><p lang=ja  dir=ltr >ATmega32U4で 孵 化 厳 選 <a href="https://t.co/iIxeC5RUdw">pic.twitter.com/iIxeC5RUdw</a></p>&mdash; へいほぅ (@h3y6e) <a href="https://twitter.com/h3y6e/status/1461719540379774982?ref_src=twsrc%5Etfw">November 19 2021</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset=utf-8 ></script> <h2 id="はじめに"><a href="#はじめに" class=header-anchor >はじめに</a></h2> <p>こんにちは、<a href="https://twitter.com/h3y6e">へいほぅ</a>です。<a href="https://camph.net/">CAMPHOR-</a>の運営メンバーです。</p> <p>皆さん『ポケットモンスター ブリリアントダイヤモンド・シャイニングパール』（以下、ポケモンBDSP）遊んでらっしゃいますでしょうか。 待ちに待ったダイパリメイクであり、望まれたバグ以外のあらゆるバグが実装されてしまったことで話題となっていますが、それらも含めて楽しく遊ばれていることと思います。</p> <p>本稿ではArduino Leonardo互換機である<a href="https://shop.yushakobo.jp/products/pro-micro">Pro Micro</a>を用い、ポケモンBDSP自動孵化装置を作成します。<br />なお本稿は任天堂の許諾を受けていない周辺機器の使用を推奨するものではありません。</p> <h2 id="ドメイン知識_タマゴ"><a href="#ドメイン知識_タマゴ" class=header-anchor >ドメイン知識: タマゴ</a></h2> <p>ポケモンのメインシリーズをやったことのある人でも、タマゴや孵化の仕様について深く知らない方も多いのではないでしょうか。<br />シリーズ全体でのタマゴに関しては <a href="https://wiki.xn--rckteqa2e.com/wiki/&#37;E3&#37;82&#37;BF&#37;E3&#37;83&#37;9E&#37;E3&#37;82&#37;B4">タマゴ - ポケモンWiki</a> や <a href="https://www.smogon.com/ingame/guides/breeding_guide_part2#hatching_eggs">The Breeding Guide Part II - Smogon University</a> が、『ポケットモンスター ダイヤモンド・パール』（以下、ポケモンDP）におけるタマゴに関しては <a href="https://w.atwiki.jp/pokemondp/pages/205.html">タマゴ - ポケットモンスターダイヤモンド、パール攻略Wiki</a> が詳しいです。以下ではポケモンBDSPで自動孵化装置を作成するにあたり必要な知識のみを説明します。</p> <h3 id="タマゴが見つかる条件"><a href="#タマゴが見つかる条件" class=header-anchor >タマゴが見つかる条件</a></h3> <p>預かり屋に2匹のポケモンを預けると、255歩毎<sup id="fnref:歩数"><a href="#fndef:歩数" class=fnref >[1]</a></sup> に以下の確率でタマゴが見つかります。 詳しくは述べませんが、預けるポケモンの種類やIDに依存し、預かり屋じいさんの台詞が変化します。</p> <ul> <li><p>「2匹の　仲は　とっても　良いようじゃ」: <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>70</mn><mi mathvariant=normal >%</mi></mrow><annotation encoding="application/x-tex">70\%</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.80556em;vertical-align:-0.05556em;"></span><span class=mord >7</span><span class=mord >0</span><span class=mord >%</span></span></span></span></p> <li><p>「2匹の　仲は　まずまずの　ようじゃ」: <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>50</mn><mi mathvariant=normal >%</mi></mrow><annotation encoding="application/x-tex">50\%</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.80556em;vertical-align:-0.05556em;"></span><span class=mord >5</span><span class=mord >0</span><span class=mord >%</span></span></span></span></p> <li><p>「2匹の　仲は　それほど　良くないがなぁ」: <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>20</mn><mi mathvariant=normal >%</mi></mrow><annotation encoding="application/x-tex">20\%</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.80556em;vertical-align:-0.05556em;"></span><span class=mord >2</span><span class=mord >0</span><span class=mord >%</span></span></span></span></p> <li><p>「お互いに　違う　ポケモン達と　遊んでおるがなぁ…」: <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mi mathvariant=normal >%</mi></mrow><annotation encoding="application/x-tex">0\%</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.80556em;vertical-align:-0.05556em;"></span><span class=mord >0</span><span class=mord >%</span></span></span></span></p> </ul> <p><img src="/img/2021-12-01/mazumazu.jpg" alt=mazumazu  /></p> <p><a href="https://wiki.xn--rckteqa2e.com/wiki/&#37;E3&#37;81&#37;BE&#37;E3&#37;82&#37;8B&#37;E3&#37;81&#37;84&#37;E3&#37;81&#37;8A&#37;E3&#37;81&#37;BE&#37;E3&#37;82&#37;82&#37;E3&#37;82&#37;8A">まるいおまもり</a> を持っていると早くタマゴが見つかるようです。 正確な確率は不明ですが、経験的に20&#37;ほど見つかる確率が上がります。</p> <table class=fndef  id="fndef:歩数"> <tr> <td class=fndef-backref ><a href="#fnref:歩数">[1]</a> <td class=fndef-content >ポケモンBDSPにおいて要検証。 </table> <h3 id="タマゴのサイクル数"><a href="#タマゴのサイクル数" class=header-anchor >タマゴのサイクル数</a></h3> <p>タマゴが孵化するまでの歩数に関与する隠しステータスで、ポケモンの種類ごとに数値が決まっています。<br />例えばコイキングは5、イーブイは35です。</p> <p><img src="/img/2021-12-01/oya.jpg" alt=oya  /></p> <p>ポケモンDP及びBDSPでは通算歩数<sup id="fnref:通算歩数"><a href="#fndef:通算歩数" class=fnref >[2]</a></sup><strong>255</strong>歩毎に1減り、サイクル数が0であるとき、タマゴが孵ります。 ただし、孵化を早める特性（『ほのおのからだ』『マグマのよろい』等）を持つポケモンが手持ちにいる場合はサイクル数が2減ります。</p> <p>例えばイーブイ（サイクル数35）のタマゴを孵化させたいとき、手持ちに特性『マグマのよろい』を持つマグカルゴがいれば、孵化に必要な歩数は</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mrow><mo fence=true >⌈</mo><mfrac><mn>35</mn><mn>2</mn></mfrac><mo fence=true >⌉</mo></mrow><mo>×</mo><mn>255</mn><mo>=</mo><mn>4590</mn><mtext> </mtext><mrow><mi mathvariant=normal >s</mi><mi mathvariant=normal >t</mi><mi mathvariant=normal >e</mi><mi mathvariant=normal >p</mi><mi mathvariant=normal >s</mi></mrow></mrow><annotation encoding="application/x-tex"> \left\lceil \frac{35}{2} \right\rceil \times 255 = 4590\ {\rm steps} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.40003em;vertical-align:-0.95003em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">⌈</span></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.32144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >2</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >3</span><span class=mord >5</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">⌉</span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >×</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >2</span><span class=mord >5</span><span class=mord >5</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class=mord >4</span><span class=mord >5</span><span class=mord >9</span><span class=mord >0</span><span class=mspace > </span><span class=mord ><span class=mord ><span class="mord mathrm">s</span><span class="mord mathrm">t</span><span class="mord mathrm">e</span><span class="mord mathrm">p</span><span class="mord mathrm">s</span></span></span></span></span></span></span> <p>となります。</p> <table class=fndef  id="fndef:通算歩数"> <tr> <td class=fndef-backref ><a href="#fnref:通算歩数">[2]</a> <td class=fndef-content ><a href="https://wiki.xn--rckteqa2e.com/wiki/&#37;E3&#37;82&#37;BF&#37;E3&#37;83&#37;9E&#37;E3&#37;82&#37;B4">ポケモンWiki</a>より引用:『タマゴ1個ごとに何歩歩いたかがカウントされている訳ではなく、主人公の通算の歩数がチェック周期の倍数を回るたびに一括でチェックが入り、「前回のチェックの時点でも手持ちにあったタマゴ」全てのサイクル数の値を1マイナスする』 </table> <h3 id="廃人ロード"><a href="#廃人ロード" class=header-anchor >廃人ロード</a></h3> <p>メインシリーズには <a href=" https://dic.nicovideo.jp/a/&#37;E5&#37;BB&#37;83&#37;E4&#37;BA&#37;BA&#37;E3&#37;83&#37;AD&#37;E3&#37;83&#37;BC&#37;E3&#37;83&#37;89">廃人ロード</a> と俗称される、育て屋/預かり屋周辺に整備された道路があります。 ポケモンDP及びBDSPにも廃人ロードは用意されており、209番道路⇔ズイタウン⇔210番道路の往復<strong>254</strong>歩の道です。</p> <h3 id="参考_ダイヤモンドダスト"><a href="#参考_ダイヤモンドダスト" class=header-anchor >参考: ダイヤモンドダスト</a></h3> <p>ポケモンDPでは、年に数回キッサキシティでダイヤモンドダストの降る日が年に数回あります。この日に限り、サイクル数を減少させる歩数は255歩でなく230歩になります。<br />ポケモンBDSPにおいてもダイヤモンドダストは存在するようですが、狙って出すためには日付を弄る必要がある<sup id="fnref:時渡り"><a href="#fndef:時渡り" class=fnref >[3]</a></sup> ため今回は考慮にいれません。</p> <table class=fndef  id="fndef:時渡り"> <tr> <td class=fndef-backref ><a href="#fnref:時渡り">[3]</a> <td class=fndef-content >単に特定の日付にすれば良いというわけではなく、2日以上（24時間1分以上）前に設定してから時間を経過させる必要があるらしい。未検証。 </table> <h2 id="nintendo_switchコントローラ"><a href="#nintendo_switchコントローラ" class=header-anchor >Nintendo Switchコントローラ</a></h2> <p>Nintendo Switchは、2017年6月20日に配信開始された本体システムバージョン3.0.0以降、Nintendo Switch Proコントローラの有線接続、及び他社製のコントローラに対応しました。 その結果、Nintendo Switchで使用出来るようになったホリ製の「『ポッ拳』専用コントローラー for Wii U」をリバースエンジニアリングしたカスタムファイトスティックのPoC、<a href="https://github.com/progmem/Switch-Fightstick">progmem/Switch-Fightstick</a> が作成されました。 マイコンを用いたNintendo Switch用カスタムコントローラの作成及び自動化はそこから広まりました。</p> <h3 id=usb_hid ><a href="#usb_hid" class=header-anchor >USB HID</a></h3> <p>Nintendo Switchのコントローラは<a href="https://www.usb.org/hid">USB HID</a>（Human Interface Devices）による通信をサポートしています<sup id="fnref:参考"><a href="#fndef:参考" class=fnref >[4]</a></sup>。</p> <p>USB HIDはコンピュータ周辺機器のUSB仕様の1つで、キーボードやマウスなどのデバイスを規定するものです。 現在のHIDデバイスは幅広いデバイスが含まれており、様々なハードウェアベンダがHIDを採用しています。</p> <p>HIDクラスでは、レポートと呼ばれる単位でデータを転送します。 Report DescriptorによってUSBデバイスに関する情報を定義しUSBホストに提供することが出来ます。 参考までに、以下にNintendo Switchのコントローラとして認識するReport Descriptorを記載します。</p> <pre><code class=language-julia >item                                | hex
-----------------------------------------------------
USAGE_PAGE &#40;Generic Desktop&#41;        | 0x05 0x01
USAGE &#40;Game Pad&#41;                    | 0x09 0x05
COLLECTION &#40;Application&#41;            | 0xa1 0x01
  LOGICAL_MINIMUM &#40;0&#41;               | 0x15 0x00
  LOGICAL_MAXIMUM &#40;1&#41;               | 0x25 0x01
  PHYSICAL_MINIMUM &#40;0&#41;              | 0x35 0x00
  PHYSICAL_MAXIMUM &#40;1&#41;              | 0x45 0x01
  REPORT_SIZE &#40;1&#41;                   | 0x75 0x01
  REPORT_COUNT &#40;16&#41;                 | 0x95 0x10
  USAGE_PAGE &#40;Button&#41;               | 0x05 0x09
  USAGE_MINIMUM &#40;1&#41;                 | 0x19 0x01
  USAGE_MAXIMUM &#40;16&#41;                | 0x29 0x10
  INPUT &#40;Data,Var,Abs&#41;              | 0x81 0x02
  USAGE_PAGE &#40;Generic Desktop&#41;      | 0x05 0x01
  LOGICAL_MAXIMUM &#40;7&#41;               | 0x25 0x07
  PHYSICAL_MAXIMUM &#40;315&#41;            | 0x46 0x3b 0x01
  REPORT_SIZE &#40;4&#41;                   | 0x75 0x04
  REPORT_COUNT &#40;1&#41;                  | 0x95 0x01
  UNIT &#40;20&#41;                         | 0x65 0x14
  USAGE &#40;Dpad Switch&#41;               | 0x09 0x39
  INPUT &#40;Data,Var,Abs&#41;              | 0x81 0x42
  UNIT &#40;0&#41;                          | 0x65 0x00
  REPORT_COUNT &#40;1&#41;                  | 0x95 0x01
  INPUT &#40;Cnst,Arr,Abs&#41;              | 0x81 0x01
  LOGICAL_MAXIMUM &#40;255&#41;             | 0x26 0xff 0x00
  PHYSICAL_MAXIMUM &#40;255&#41;            | 0x46 0xff 0x00
  USAGE &#40;X&#41;                         | 0x09 0x30
  USAGE &#40;Y&#41;                         | 0x09 0x31
  USAGE &#40;Z&#41;                         | 0x09 0x32
  USAGE &#40;Rz&#41;                        | 0x09 0x35
  REPORT_SIZE &#40;8&#41;                   | 0x75 0x08
  REPORT_COUNT &#40;4&#41;                  | 0x95 0x04
  INPUT &#40;Data,Var,Abs&#41;              | 0x81 0x02
  USAGE_PAGE &#40;Vendor Defined 65280&#41; | 0x06 0x00 0xff
  USAGE &#40;32&#41;                        | 0x09 0x20
  REPORT_COUNT &#40;1&#41;                  | 0x95 0x01
  INPUT &#40;Data,Var,Abs&#41;              | 0x81 0x02
  USAGE &#40;9761&#41;                      | 0x0a 0x21 0x26
  REPORT_COUNT &#40;8&#41;                  | 0x95 0x08
  OUTPUT &#40;Data,Var,Abs&#41;             | 0x91 0x02
END_COLLECTION                      | 0xc0</code></pre> <table class=fndef  id="fndef:参考"> <tr> <td class=fndef-backref ><a href="#fnref:参考">[4]</a> <td class=fndef-content ><a href="https://github.com/dekuNukem/Nintendo_Switch_Reverse_Engineering">dekuNukem/Nintendo&#95;Switch&#95;Reverse&#95;Engineering: A look at inner workings of Joycon and Nintendo Switch</a> <a href="https://www.wdic.org/w/TECH/USB&#37;20HID&#37;20&#37;E3&#37;82&#37;AF&#37;E3&#37;83&#37;A9&#37;E3&#37;82&#37;B9">USB HIDクラス ‐ 通信用語の基礎知識</a> </table> <h3 id=atmega32u4 ><a href="#atmega32u4" class=header-anchor >ATmega32U4</a></h3> <figure> <img src="/img/2021-12-01/promicro.jpg"/> <figcaption>Pro Micro。中央のマイクロコントローラがATmega34U4。</figcaption> </figure> <p>ATmega32U4マイコンにはHID機能があるため、ATmega32u4を搭載したPro MicroはNintendo Switchコントローラとして動作します。 Arduinoの<a href="https://www.arduino.cc/en/Reference/HID">HID library</a>を用いれば、コントローラを実装出来ます。</p> <h2 id="実装"><a href="#実装" class=header-anchor >実装</a></h2> <p>全てのコードは下記リポジトリにあります。</p> <div class=iframely-embed ><div class=iframely-responsive  style="height: 140px; padding-bottom: 0;"><a href="https://github.com/h3y6e/birdo" data-iframely-url="//cdn.iframe.ly/JgnZlBb?card=small"></a></div></div><script async src="//cdn.iframe.ly/embed.js" charset=utf-8 ></script> <p>Arduino Libraryとして、MIT License下にある <a href="https://github.com/celclow/SwitchControlLibrary">celclow/SwitchControlLibrary</a> を改変したものを利用させていただいております。</p> <h3 id="方針"><a href="#方針" class=header-anchor >方針</a></h3> <p>Arduinoスケッチとしてinoファイルに記述するコードは、押すボタンを時間で管理しているだけなので大したものでは無いです。</p> <ol> <li><p>初期位置に移動する</p> <li><p>タマゴを30回受け取りボックスに送る</p> <li><p>ボックス1個分を孵化させる</p> <ol> <li><p>1列分のタマゴを手持ちに入れる</p> <li><p>廃人ロードを往復する</p> <li><p>孵化したらボックスを開き手持ちを入れ替える</p> </ol> <li><p>1.に戻る</p> </ol> <p>これを実装します。<br />出来るだけ早くサイクルを回せて、かつ安定して動作し続けることを目指しています。</p> <h3 id="初期位置に移動する"><a href="#初期位置に移動する" class=header-anchor >初期位置に移動する</a></h3> <p>HIDデバイスから同じ入力を与えていても、ホスト側の状態によって入力にズレが生じます。 安定した動作のためには、定期的に初期位置に戻る必要があります。</p> <p>初期位置をポケモンセンター前と定義すれば「そらをとぶ」を利用することで必ず同じ場所に戻ることが出来ます。 今回は廃人ロード最南（209番道路側の突き当り）を初期位置として採用しました。 これは多少X座標がずれていても看板・NPC・坂道によって廃人ロード上に乗るように補正され、また「そらをとぶ」にかかる時間よりも自転車で南下する時間のほうが短い為です。</p> <pre><code class=language-cxx >void moveToInit&#40;&#41; &#123;
  // メニューを開く
  pushButton&#40;X, 500&#41;;
  // 「タウンマップ」を押す
  tiltLeftJoystick&#40;-100, -100, 1000&#41;;
  // マップ画面が開くまで待機
  pushButton&#40;A, 1100&#41;;
  // ズイタウン を選択する
  pushButton&#40;A, 700&#41;;
  // 「はい」を押し、ポケモンセンター前に移動するまで待機
  pushButton&#40;A, 7000&#41;;
  // 初期位置に移動
  tiltLeftJoystick&#40;-100, 0, 600&#41;;
  rideBike&#40;&#41;;
  tiltLeftJoystick&#40;0, 100, 5300&#41;;
&#125;</code></pre> <h3 id="タマゴを受け取る"><a href="#タマゴを受け取る" class=header-anchor >タマゴを受け取る</a></h3> <p>先に述べたようにタマゴを受け取れるかどうかは確率なので、タマゴが受け取れない場合も考えて実装する必要があります。 タマゴが受け取れるときは以下のように会話が進みます。A/Bボタン14回で会話が終了します。</p> <pre><code class=language-julia >*   おお！　あんたか
*   預かっていた　ポケモンを　世話して　おったら……　なんと！
*   ポケモンが　タマゴを　持っておったんじゃ！
*   どこから　持ってきたか　わからんが　あんたの　ポケモンが　持っていた
*   タマゴなんじゃ
*   やっぱり　欲しいじゃろ？
*   &#91;はい&#93;
*   へいほぅは　預かり屋　じいさんから　
*   タマゴを　もらった！
*   「タマゴを　ボックスへ　送信しました！」
*   大事に　育てなさいよ！</code></pre> <p>タマゴを受け取れないときは以下のように会話が進みます。A/Bボタン4回で会話が終了します。</p> <pre><code class=language-julia >*   おお　あんたか！　よく来たな
*   &#91;ポケモン&#93;と　&#91;ポケモン&#93;は　元気じゃぞ！
*   2匹の　仲は とっても 良いようじゃ
*         or まずまずの　ようじゃ
*         or それほど　良くないがなぁ</code></pre> <p>また、会話中でないときはBボタンを押すと自転車のギアチェンジを行ってしまう為、ギアを4速に戻すためBボタンを偶数回押す必要があります。 従って、Aボタンを12回、Bボタンを2回押せばどちらの状況にも対応出来ます。</p> <pre><code class=language-cxx >void getEgg&#40;&#41; &#123;
  // 話し掛ける
  pushButton&#40;A, 400, 4&#41;;
  pushButton&#40;B, 400, 2&#41;;
  pushButton&#40;A, 400, 4&#41;;
  flash&#40;7&#41;;
  pushButton&#40;A, 600, 2&#41;;
  pushButton&#40;A, 400, 2&#41;;
&#125;</code></pre> <h3 id="廃人ロードを往復する"><a href="#廃人ロードを往復する" class=header-anchor >廃人ロードを往復する</a></h3> <p>往復254歩、所要時間20800msです。</p> <pre><code class=language-cxx >void roundTrip&#40;int times&#41; &#123;
  for &#40;int i &#61; 0; i &lt; times; i&#43;&#43;&#41; &#123;
    tiltLeftJoystick&#40;0, -100, 10400&#41;;  // 127歩
    tiltLeftJoystick&#40;0, 100, 10400&#41;;   // 127歩
  &#125;
&#125;

void hatch&#40;&#41; &#123;
  // ⌈EGG_CYCLE / 2⌉ * 254歩
  roundTrip&#40;&#40;EGG_CYCLE &#43; 1&#41; / 2&#41;;
  tiltLeftJoystick&#40;0, -100, 10400&#41;;
  for &#40;int i &#61; 0; i &lt; 5; i&#43;&#43;&#41; &#123;
    pushButton&#40;A, 200, 2&#41;;
    flash&#40;76&#41;;
    pushButton&#40;A, 5000&#41;;
  &#125;
&#125;</code></pre> <h3 id="ボックスを操作する"><a href="#ボックスを操作する" class=header-anchor >ボックスを操作する</a></h3> <p>ポケットモンスター ソード・シールドに対しても同様の実装をしていたのですが、それと比べて全体的に動作が遅く、1操作あたり50msほど増やさないと安定しませんでした。</p> <h4 id="手持ちのポケモンをボックスに預ける"><a href="#手持ちのポケモンをボックスに預ける" class=header-anchor >手持ちのポケモンをボックスに預ける</a></h4> <pre><code class=language-cxx >void sendToBox&#40;int column&#41; &#123;
  /* 手持ちの孵化したポケモンを範囲選択してボックスの指定列に移す */
  // 「はんい」モードにする
  pushButton&#40;Y, 100, 2&#41;;
  // ポケモンの2匹目にカーソルを当てる
  pushDpad&#40;LEFT, 200&#41;;
  pushDpad&#40;DOWN, 100&#41;;
  // 手持ちのポケモン5匹を範囲選択する
  pushButton&#40;A, 100&#41;;
  pushDpad&#40;DOWN, 50, 100, 3&#41;;
  pushDpad&#40;DOWN, 150&#41;;
  // 選択したポケモンを持ち上げる
  pushButton&#40;A, 150&#41;;
  // 指定列にポケモンを移動させる
  pushDpad&#40;UP, 100&#41;;
  if &#40;column &lt; 3&#41; &#123;
    pushDpad&#40;RIGHT, 50, 100, column &#43; 1&#41;;
  &#125; else &#123;
    pushDpad&#40;LEFT, 50, 100, 6 - column&#41;;
  &#125;
  pushButton&#40;A, 150&#41;;
&#125;</code></pre> <h4 id="手持ちに入れる"><a href="#手持ちに入れる" class=header-anchor >手持ちに入れる</a></h4> <pre><code class=language-cxx >void returnFromBox&#40;int column&#41; &#123;
  // ポケモン5匹を範囲選択する
  pushButton&#40;A, 100&#41;;
  pushDpad&#40;DOWN, 50, 100, 3&#41;;
  pushDpad&#40;DOWN, 150&#41;;
  // 選択したポケモンを持ち上げる
  pushButton&#40;A, 150&#41;;
  // 手持ちにポケモンを移動する
  pushDpad&#40;DOWN, 100&#41;;
  if &#40;column &lt; 3&#41; &#123;
    pushDpad&#40;LEFT, 50, 100, column &#43; 1&#41;;
  &#125; else &#123;
    pushDpad&#40;RIGHT, 50, 100, 6 - column&#41;;
  &#125;
  pushButton&#40;A, 600&#41;;
&#125;</code></pre> <h4 id="ボックスを入れ替える"><a href="#ボックスを入れ替える" class=header-anchor >ボックスを入れ替える</a></h4> <pre><code class=language-cxx >void swapBox&#40;int box&#41; &#123;
  // ボックス一覧
  pushDpad&#40;UP, 150&#41;;
  pushDpad&#40;UP, 100&#41;;
  pushDpad&#40;LEFT, 100&#41;;
  pushButton&#40;A, 500&#41;;
  // 1番目と2番目を入れ替え
  pushButton&#40;Y, 100&#41;;
  pushDpad&#40;RIGHT, 50&#41;;
  pushButton&#40;Y, 100&#41;;
  if &#40;box &gt; 2&#41; &#123;
    // 1番目とbox番目を入れ替え
    pushDpad&#40;LEFT, 50&#41;;
    pushButton&#40;Y, 150&#41;;
    if &#40;box &lt; 4&#41; &#123;
      pushDpad&#40;RIGHT, 50, 100, box - 1&#41;;
    &#125; else &#123;
      pushDpad&#40;LEFT, 50, 100, 7 - box&#41;;
    &#125;
    pushButton&#40;Y, 100&#41;;
  &#125;
  pushButton&#40;B, 400&#41;;
&#125;</code></pre> <h2 id="結果"><a href="#結果" class=header-anchor >結果</a></h2> <p>色違いイーブイは出ませんでした。いや <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mi mathvariant=normal >/</mi><mn>4096</mn><mo>≈</mo><mn>0.02</mn><mi mathvariant=normal >%</mi></mrow><annotation encoding="application/x-tex">1/4096\approx0.02\%</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mord >1</span><span class=mord >/</span><span class=mord >4</span><span class=mord >0</span><span class=mord >9</span><span class=mord >6</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >≈</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.80556em;vertical-align:-0.05556em;"></span><span class=mord >0</span><span class=mord >.</span><span class=mord >0</span><span class=mord >2</span><span class=mord >%</span></span></span></span> なんて引けねえよ。</p> <h2 id="おわりに"><a href="#おわりに" class=header-anchor >おわりに</a></h2> <p>イーブイの孵化余りが大量にいるので、欲しい方がいらっしゃいましたら渡します。<br />代わりにムンボor海外産イーブイが欲しいです。誰かください。</p> <p><img src="/img/2021-12-01/6v.jpg" alt="6v eevee" /></p> <footer class=page-foot > <div class=copyright > <span> &copy; 2019-2022 <a href="https://h3y6e.com">heyhoe</a> </span> <span>::Powered py <a href="https://franklinjl.org/">Franklin.jl</a></span> </div> </footer> </div> <script> renderMathInElement(document.body); </script> <script src="/libs/highlight/highlight.min.js"></script> <script src="/libs/highlight/ln.min.js"></script> <script> hljs.initHighlightingOnLoad(); hljs.initLineNumbersOnLoad({ singleLine: true }); hljs.configure({ tabReplace: " " }); </script>